<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2019 Creu Blanca
     License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl). -->

<odoo>

    <record model="ir.ui.view" id="hr_equipment_request_view_form">
        <field name="name">maintenance.request.form (in cb_maintenance)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance.hr_equipment_request_view_form"/>
        <field name="arch" type="xml">
            <form position="attributes">
                <attribute name="create">false</attribute>
                <attribute name="delete">false</attribute>
                <attribute name="edit">false</attribute>
            </form>

            <field name="name" position="before">
                <i class="fa fa-home" attrs="{'invisible': [('maintenance_type', '!=', 'preventive')]}" style="margin-right: 10px"/>
                <i class="fa fa-tools" attrs="{'invisible': [('maintenance_type', '!=', 'corrective')]}" style="margin-right: 10px"/>
            </field>

            <button name="archive_equipment_request" position="before">
                <button string="Assign to another Team" name="%(cb_maintenance.wizard_change_maintenance_team_act_window)d"
                        type="action" attrs="{'invisible': [('archive', '=', True)]}"/>
            </button>

            <xpath expr="//span[hasclass('label')]/.." position="after">
                <div>
                    <span class="label label-info pull-right" attrs="{'invisible': [('state', '!=', 'new')]}">
                        <field style="margin-top: 6px" name="stage_id" options="{'no_open': True, 'no_create': True}"/>
                    </span>
                    <span class="label label-success pull-right" attrs="{'invisible': [('state', '!=', 'open')]}">
                        <field style="margin-top: 6px" name="stage_id" options="{'no_open': True, 'no_create': True}"/>
                    </span>
                    <span class="label label-danger pull-right" attrs="{'invisible': [('state', '!=', 'closed')]}">
                        <field style="margin-top: 6px" name="stage_id" options="{'no_open': True, 'no_create': True}"/>
                    </span>
                </div>
            </xpath>

            <field name="technician_user_id" position="after">
                <field name="manager_id" options="{'no_open': True, 'no_create': True}"/>
                <field name="technician_id" options="{'no_open': True, 'no_create': True}"/>
                <field name="write_date" readonly="1"/>
                <field name="maintenance_team_id_member_ids" invisible="1"/>
            </field>
            <field name="technician_user_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <xpath expr="//div[hasclass('oe_right')]" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>

            <field name="name" position="after">
                <span style="margin-left: 0.5em"/>
                <field name="kanban_state" class="oe_inline" widget="state_selection"/>
            </field>

            <field name="description" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="close_date" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <field name="close_date" position="after">
                <field name="close_datetime" attrs="{'invisible': [('close_datetime', '=', False)]}"/>
            </field>
            <button name="archive_equipment_request" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>

            <field name="description" position="after">
                <group string="Description">
                    <field name="description" placeholder="Issue description..." nolabel="1"/>
                </group>
            </field>

            <field name="request_date" position="replace">
                <field name="create_date" string="Request Date" readonly="1"/>
            </field>

            <field name="category_id" position="attributes">
                <attribute name="attrs"/>
            </field>
            <field name="category_id" position="after">
                <field name="sub_category_id" options="{'no_open': True, 'no_create': True}"
                       attrs="{'invisible': [('category_id', '=', False)]}"
                       domain="[('id', 'child_of', category_id)]"/>
            </field>

            <field name="stage_id" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <field name="stage_id" position="after">
                <field name="state" widget="statusbar"/>
            </field>
        </field>
    </record>

    <record model="ir.ui.view" id="hr_equipment_request_manager_view_form">
        <field name="name">maintenance.request.form (in cb_maintenance for manager)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="hr_equipment_request_view_form"/>
        <field name="groups_id" eval="[(4, ref('maintenance.group_equipment_manager'))]"/>
        <field name="arch" type="xml">
            <form position="attributes">
                <attribute name="create">true</attribute>
                <attribute name="edit">true</attribute>
            </form>
        </field>
    </record>

    <record model="ir.ui.view" id="maintenance_request_tree_view">
        <field name="name">maintenance.request.tree (in cb_maintenance)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance.hr_equipment_request_view_tree"/>
        <field name="arch" type="xml">
            <tree position="attributes">
                <attribute name="create">false</attribute>
                <attribute name="delete">false</attribute>
            </tree>
            <field name="name" position="after">
                <field name="maintenance_type" invisible="1"/>
            </field>
        </field>
    </record>


    <record model="ir.ui.view" id="maintenance_request_manager_tree_view">
        <field name="name">maintenance.request.tree (in cb_maintenance for manager)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance_request_tree_view"/>
        <field name="groups_id" eval="[(4, ref('maintenance.group_equipment_manager'))]"/>
        <field name="arch" type="xml">
            <tree position="attributes">
                <attribute name="create">true</attribute>
            </tree>
        </field>
    </record>

    <record model="ir.ui.view" id="maintenance_request_kanban_view">
        <field name="name">maintenance.request.kanban (in cb_maintenance)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance.hr_equipment_request_view_kanban"/>
        <field name="arch" type="xml">
            <kanban position="attributes">
                <attribute name="group_create">false</attribute>
                <attribute name="create">false</attribute>
                <attribute name="delete">false</attribute>
            </kanban>
            <xpath expr="//div[hasclass('o_dropdown_kanban')]" position="attributes">
                <attribute name="t-if">1==0</attribute>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="maintenance_request_manager_kanban_view">
        <field name="name">maintenance.request.kanban (in cb_maintenance for manager)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance_request_kanban_view"/>
        <field name="groups_id" eval="[(4, ref('maintenance.group_equipment_manager'))]"/>
        <field name="arch" type="xml">
            <kanban position="attributes">
                <attribute name="create">true</attribute>
            </kanban>
        </field>
    </record>

    <record model="ir.ui.view" id="hr_equipment_request_view_search">
        <field name="name">maintenance.request.kanban (in cb_maintenance for manager)</field>
        <field name="model">maintenance.request</field>
        <field name="inherit_id" ref="maintenance.hr_equipment_request_view_search"/>
        <field name="arch" type="xml">
            <filter name="my_requests" position="attributes">
                <attribute name="domain">[('follower_id', '=', uid)]</attribute>
                <attribute name="string">On my hands</attribute>
            </filter>
            <filter name="my_requests" position="after">
                <filter name="managed_by_me" string="Managed by me" domain="[('manager_id', '=', uid)]"/>
                <filter name="created_by_me" string="Created by me" domain="[('owner_user_id', '=', uid)]"/>
            </filter>
        </field>
    </record>

    <record id="maintenance.hr_equipment_request_action" model="ir.actions.act_window">
        <field name="view_mode">kanban,tree,form</field>
    </record>

    <menuitem
        id="menu_m_request_label"
        name="Maintenance Requests"
        parent="maintenance.menu_m_request"
        groups="maintenance.group_equipment_manager,base.group_user"
        sequence="1"/>

    <record model="ir.ui.menu" id="maintenance.menu_m_request_form">
        <field name="name">View Maintenance Requests</field>
        <field name="parent_id" ref="menu_m_request_label"/>
        <field name="sequence" eval="10"/>
    </record>

    <record model="ir.ui.menu" id="maintenance.menu_m_request_calendar">
        <field name="active" eval="False"/>
    </record>

    <record model="ir.ui.view" id="maintenance_plan.hr_equipment_request_view_form">
        <field name="active" eval="False"/>
    </record>
</odoo>
